<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - HindTrade AI</title>
    <meta name="description" content="HindTrade AI - Agent-Led Trade Network">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/supabase-config.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #050810 0%, #0F1428 50%, #050810 100%);
            color: #E5E7EB;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(15, 20, 40, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 217, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .glass-card:hover {
            border-color: rgba(0, 217, 255, 0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #00D9FF 0%, #0099CC 100%);
            color: #0A0E27;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 217, 255, 0.4);
        }
        
        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #00D9FF;
            background: rgba(0, 217, 255, 0.05);
            box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.1);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #00D9FF 0%, #FFB800 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .tab-active {
            color: #00D9FF;
            border-bottom: 2px solid #00D9FF;
        }
        
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #FCA5A5;
        }
        
        .success-message {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #6EE7B7;
        }
        
        .loading {
            pointer-events: none;
            opacity: 0.6;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl"></div>
    </div>

    <div class="glass-card rounded-2xl p-8 w-full max-w-md relative z-10">
        <div class="text-center mb-8">
            <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center text-white font-bold text-2xl mx-auto mb-4 shadow-lg">
                H
            </div>
            <h1 class="text-3xl font-bold gradient-text mb-2">HindTrade AI</h1>
            <p class="text-gray-400 text-sm">Global Trade Operating System</p>
        </div>

        <div class="flex border-b border-gray-700 mb-6">
            <button onclick="switchTab('login')" id="tab-login" class="tab-active flex-1 pb-3 text-sm font-semibold transition-colors">
                Login
            </button>
            <button onclick="switchTab('signup')" id="tab-signup" class="flex-1 pb-3 text-sm font-semibold text-gray-400 hover:text-gray-300 transition-colors">
                Sign Up
            </button>
        </div>

        <div id="message-container" class="mb-4"></div>

        <form id="login-form" class="space-y-4">
            <div>
                <label class="block text-gray-400 text-xs font-semibold uppercase tracking-wide mb-2">Email</label>
                <input type="email" id="login-email" class="input-field w-full px-4 py-3 rounded-lg text-sm" placeholder="your@email.com" required>
            </div>
            
            <div>
                <label class="block text-gray-400 text-xs font-semibold uppercase tracking-wide mb-2">Password</label>
                <input type="password" id="login-password" class="input-field w-full px-4 py-3 rounded-lg text-sm" placeholder="••••••••" required>
            </div>
            
            <div class="flex items-center justify-between text-xs">
                <label class="flex items-center text-gray-400">
                    <input type="checkbox" class="mr-2 rounded">
                    Remember me
                </label>
                <button type="button" onclick="handleForgotPassword()" class="text-blue-400 hover:text-blue-300">
                    Forgot password?
                </button>
            </div>
            
            <button type="submit" class="btn-primary w-full py-3 rounded-lg font-semibold flex items-center justify-center">
                <span id="login-btn-text">Login to Dashboard</span>
                <i id="login-spinner" class="ri-loader-4-line spinner ml-2 hidden"></i>
            </button>
        </form>

        <form id="signup-form" class="space-y-4 hidden">
            <div>
                <label class="block text-gray-400 text-xs font-semibold uppercase tracking-wide mb-2">Full Name</label>
                <input type="text" id="signup-fullname" class="input-field w-full px-4 py-3 rounded-lg text-sm" placeholder="John Doe" required>
            </div>
            
            <div>
                <label class="block text-gray-400 text-xs font-semibold uppercase tracking-wide mb-2">Company Name</label>
                <input type="text" id="signup-company" class="input-field w-full px-4 py-3 rounded-lg text-sm" placeholder="Acme Exports Ltd" required>
            </div>
            
            <div>
                <label class="block text-gray-400 text-xs font-semibold uppercase tracking-wide mb-2">Location</label>
                <input type="text" id="signup-location" class="input-field w-full px-4 py-3 rounded-lg text-sm" placeholder="Mumbai, India" required>
            </div>
            
            <div>
                <label class="block text-gray-400 text-xs font-semibold uppercase tracking-wide mb-2">Email</label>
                <input type="email" id="signup-email" class="input-field w-full px-4 py-3 rounded-lg text-sm" placeholder="your@email.com" required>
            </div>
            
            <div>
                <label class="block text-gray-400 text-xs font-semibold uppercase tracking-wide mb-2">Password</label>
                <input type="password" id="signup-password" class="input-field w-full px-4 py-3 rounded-lg text-sm" placeholder="••••••••" required minlength="6">
            </div>
            
            <div class="text-xs text-gray-400">
                <label class="flex items-start">
                    <input type="checkbox" class="mr-2 mt-0.5" required>
                    <span>I agree to the <a href="#" class="text-blue-400 hover:text-blue-300">Terms of Service</a> and <a href="#" class="text-blue-400 hover:text-blue-300">Privacy Policy</a></span>
                </label>
            </div>
            
            <button type="submit" class="btn-primary w-full py-3 rounded-lg font-semibold flex items-center justify-center">
                <span id="signup-btn-text">Create Account</span>
                <i id="signup-spinner" class="ri-loader-4-line spinner ml-2 hidden"></i>
            </button>
        </form>

        <div class="mt-6 text-center">
            <a href="landing.html" class="text-xs text-gray-400 hover:text-gray-300 transition-colors">
                <i class="ri-arrow-left-line mr-1"></i>Back to Home
            </a>
        </div>
    </div>

    <script>
        // Check if user is already logged in
        async function checkSession() {
            const session = await htAPI.getCurrentSession();
            if (session) {
                console.log('✅ User already logged in, redirecting to dashboard');
                window.location.href = 'dashboard.html';
            }
        }
        
        checkSession();

        // Tab Switching
        function switchTab(tab) {
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const loginTab = document.getElementById('tab-login');
            const signupTab = document.getElementById('tab-signup');
            
            clearMessages();
            
            if (tab === 'login') {
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
                loginTab.classList.add('tab-active');
                signupTab.classList.remove('tab-active');
                signupTab.classList.add('text-gray-400');
            } else {
                loginForm.classList.add('hidden');
                signupForm.classList.remove('hidden');
                signupTab.classList.add('tab-active');
                loginTab.classList.remove('tab-active');
                loginTab.classList.add('text-gray-400');
            }
        }

        // Message Functions
        function showMessage(message, type = 'error') {
            const container = document.getElementById('message-container');
            const className = type === 'error' ? 'error-message' : 'success-message';
            const icon = type === 'error' ? 'ri-error-warning-line' : 'ri-checkbox-circle-line';
            
            container.innerHTML = `
                <div class="${className} px-4 py-3 rounded-lg text-sm flex items-start">
                    <i class="${icon} mr-2 text-lg flex-shrink-0"></i>
                    <span>${message}</span>
                </div>
            `;
        }

        function clearMessages() {
            document.getElementById('message-container').innerHTML = '';
        }

        // Login Handler
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const btnText = document.getElementById('login-btn-text');
            const spinner = document.getElementById('login-spinner');
            const form = document.getElementById('login-form');
            
            clearMessages();
            form.classList.add('loading');
            btnText.textContent = 'Logging in...';
            spinner.classList.remove('hidden');
            
            try {
                const result = await htAPI.signIn(email, password);
                
                if (result.success) {
                    showMessage('Login successful! Redirecting...', 'success');
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 1000);
                } else {
                    throw new Error(result.error || 'Login failed');
                }
            } catch (error) {
                console.error('Login error:', error);
                showMessage(error.message || 'Login failed. Please check your credentials.', 'error');
                form.classList.remove('loading');
                btnText.textContent = 'Login to Dashboard';
                spinner.classList.add('hidden');
            }
        });

        // Sign Up Handler
        document.getElementById('signup-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const fullName = document.getElementById('signup-fullname').value;
            const companyName = document.getElementById('signup-company').value;
            const location = document.getElementById('signup-location').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const btnText = document.getElementById('signup-btn-text');
            const spinner = document.getElementById('signup-spinner');
            const form = document.getElementById('signup-form');
            
            clearMessages();
            form.classList.add('loading');
            btnText.textContent = 'Creating account...';
            spinner.classList.remove('hidden');
            
            try {
                const result = await htAPI.signUp(email, password, {
                    full_name: fullName,
                    company_name: companyName,
                    location: location
                });
                
                if (result.success) {
                    showMessage('Account created successfully! Redirecting to dashboard...', 'success');
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 2000);
                } else {
                    throw new Error(result.error || 'Sign up failed');
                }
            } catch (error) {
                console.error('Sign up error:', error);
                showMessage(error.message || 'Sign up failed. Please try again.', 'error');
                form.classList.remove('loading');
                btnText.textContent = 'Create Account';
                spinner.classList.add('hidden');
            }
        });

        // Forgot Password Handler
        async function handleForgotPassword() {
            const email = prompt('Enter your email address to reset password:');
            
            if (!email) return;
            
            if (!email.includes('@')) {
                alert('Please enter a valid email address');
                return;
            }
            
            try {
                const result = await htAPI.resetPassword(email);
                
                if (result.success) {
                    showMessage('Password reset email sent! Check your inbox.', 'success');
                } else {
                    throw new Error(result.error || 'Failed to send reset email');
                }
            } catch (error) {
                console.error('Password reset error:', error);
                showMessage(error.message || 'Failed to send reset email', 'error');
            }
        }
    </script>
</body>
</html>
